<app-navigation />

<div class="container-fluid p-4">
  <div class="d-flex flex-lg-row flex-column">
    <div class="profile-image border rounded">
      <img class="rounded img-fluid" [src]="sharedService.getImage(user?.profileImage?.url, user?.genderId)" alt="Profile image" />
    </div>

    <div class="col-9 ms-lg-4">
      <div class="row">
        <span class="col-lg-2 col-12 fw-semibold">Full Name:</span>
        <span class="col-lg-10 col-12">{{ user?.fullName }}</span>
      </div>
      <div class="row">
        <span class="col-lg-2 col-12 fw-semibold">Username:</span>
        <span class="col-lg-10 col-12">{{ user?.username }}</span>
      </div>
      <div class="row">
        <span class="col-lg-2 col-12 fw-semibold">Posts:</span>
        <span class="col-lg-10 col-12" [ngClass]="{'text-black-50': !user?.posts}">{{ user?.posts }}</span>
      </div>
      <div class="row">
        <span class="col-lg-2 col-12 fw-semibold">Followers:</span>
        <span class="col-lg-10 col-12" [ngClass]="{'text-black-50': !user?.followers}">{{ user?.followers }}</span>
      </div>
      <div class="row">
        <span class="col-lg-2 col-12 fw-semibold">Following:</span>
        <span class="col-lg-10 col-12" [ngClass]="{'text-black-50': !user?.following}">{{ user?.following }}</span>
      </div>
      <div class="row">
        <span class="col-lg-2 col-12 fw-semibold">Biography:</span>
        <span class="col-lg-10 col-12" [innerHtml]="user?.biography | formatText"></span>
      </div>
    </div>
  </div>

  <div class="mt-lg-3 mt-1 d-flex dropdown">
    @if (isCurrentUser)
    {
    <button class="btn btn-outline-primary px-3" [routerLink]="['/profile', userId, 'edit']">Edit profile</button>
    <button class="btn btn-outline-primary ms-1 text-center" type="button" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="fa-solid fa-gear"></i>
    </button>
    <ul class="dropdown-menu">
      <li>
        <a class="dropdown-item" style="cursor: pointer;" (click)="fileUpload.click()">Upload profile image</a>
        <input type="file" style="display: none" #fileUpload (change)="onFileChange($event)" />
      </li>
      <li>
        <a class="dropdown-item" [routerLink]="['/post/create']">Create post</a>
      </li>
      <li>
        <a class="dropdown-item" [routerLink]="['/profile', userId, 'myNotifications']">My notifications</a>
      </li>
      @if (hasAdminAccess)
      {
      <li>
        <a class="dropdown-item" [routerLink]="['/admin/panel']"><i class="fa-solid fa-gear"></i> Admin Panel</a>
      </li>
      }
    </ul>
    }
    @else if (followStatus == eFollowStatus.Pending)
    {
    <button class="btn btn-primary px-3" disabled>Pending request</button>
    }
    @else if (followStatus == eFollowStatus.Active)
    {
    <button class="btn btn-outline-primary px-3" (click)="unfollow()">Unfollow</button>
    <button class="btn btn-outline-primary px-3 ms-1" (click)="openConversation()">Message</button>
    }
    @else
    {
    <button class="btn btn-primary px-3" (click)="follow()">Follow</button>
    }
  </div>

  @if (isCurrentUser ||
      (user?.isPrivate && followStatus == eFollowStatus.Active) ||
      !user?.isPrivate
  )
  {
  <div class="fs-5 my-3">Posts</div>
  <app-posts [userId]="userId" />
  }
</div>
